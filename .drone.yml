pipeline:
  build:
    image: python:latest
    pull: true
    secrets: [ jtcat_bot_token ]
    commands:
      - export jtcat_bot_token=$JTCAT_BOT_TOKEN
      - apt install python3-pip
      - pip3 install -r requirements.txt
      - python3 test.py
      - pyinstaller -F main.py
      - mv dist/main jtcat_bot
      - rm build/ dist/ -rf
  deploy:
    image: appleboy/drone-scp
    host:
      - us.jtnet.xyz
    user: jiting
    port: 22
    secrets: [ ssh_password ]
    target: /home/jiting/
    source:
      - jtcat_bot
  run:
    image: appleboy/drone-ssh
    host: us.jtnet.xyz
    username: jiting
    port: 22
    secrets: [ ssh_password ]
    script:
      - cd /home/jiting/
      - echo $(date) >> run.txt
